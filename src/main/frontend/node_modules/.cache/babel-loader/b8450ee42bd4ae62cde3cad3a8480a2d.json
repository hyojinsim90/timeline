{"ast":null,"code":"var _jsxFileName = \"C:\\\\dev\\\\springboot\\\\workplace\\\\tiltest3\\\\src\\\\main\\\\frontend\\\\src\\\\hoc\\\\auth.js\";\nimport React, { useEffect } from \"react\";\nimport { auth } from \"../_actions/user_actions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useCookies } from \"react-cookie\";\nimport Axios from \"axios\";\nimport { useHistory } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function authHoc(SpecificComponent, option, adminRoute = null) {\n  var _s = $RefreshSig$();\n\n  function AuthenticationCheck(props) {\n    _s();\n\n    const [cookies, setCookie, removeCookie] = useCookies([]);\n    let user = useSelector(state => state.user);\n    const history = useHistory();\n    const dispatch = useDispatch();\n\n    const removeCookies = () => {\n      removeCookie(\"tl_e\");\n      removeCookie(\"tl_re\");\n      removeCookie(\"tl_exp\");\n      removeCookie(\"tl_token\");\n      window.location.reload();\n      history.push(\"/login\");\n    };\n\n    useEffect(() => {\n      if (cookies.tl_e && cookies.tl_token && cookies.tl_re && cookies.tl_exp) {\n        const date = new Date();\n        const expTime = parseInt(cookies.tl_exp);\n        const tokens = {\n          \"accessToken\": cookies.tl_token,\n          \"refreshToken\": cookies.tl_re\n        };\n        let over3h = expTime + 10800000;\n\n        if (date.getTime() > expTime) {\n          // 로그인 후 3시간 이상 지났을 때는 cookie 삭제\n          if (date.getTime() > over3h) {\n            removeCookies();\n          }\n\n          Axios.post(\"/auth/reissue\", tokens).then(res => {\n            setCookie(\"tl_token\", res.data.accessToken);\n            setCookie(\"tl_exp\", res.data.accessTokenExpiresIn);\n            setCookie(\"tl_re\", res.data.refreshToken);\n            history.push(\"/mypage\");\n            window.location.reload();\n          }).catch(err => {\n            removeCookies();\n          });\n        } // member 정보 가져오기 위해 header에 token 담아서 넘김\n\n\n        Axios.defaults.headers.common['Authorization'] = `Bearer ${cookies.tl_token}`;\n        dispatch(auth(cookies.tl_e)); // cookie에 token 관련 값 4개 중 하나라도 없으면 쿠키 삭제 후 login 페이지로 이동\n      } else {\n        if (option) {\n          removeCookie(\"tl_e\");\n          removeCookie(\"tl_re\");\n          removeCookie(\"tl_exp\");\n          removeCookie(\"tl_token\");\n          history.push(\"/login\");\n        }\n      }\n    }, [cookies]);\n    return /*#__PURE__*/_jsxDEV(SpecificComponent, { ...props,\n      user: user\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 9\n    }, this);\n  }\n\n  _s(AuthenticationCheck, \"BhFgtMggAP7YPVmmdMsuozKh3tk=\", false, function () {\n    return [useCookies, useSelector, useHistory, useDispatch];\n  });\n\n  return AuthenticationCheck;\n}","map":{"version":3,"sources":["C:/dev/springboot/workplace/tiltest3/src/main/frontend/src/hoc/auth.js"],"names":["React","useEffect","auth","useSelector","useDispatch","useCookies","Axios","useHistory","authHoc","SpecificComponent","option","adminRoute","AuthenticationCheck","props","cookies","setCookie","removeCookie","user","state","history","dispatch","removeCookies","window","location","reload","push","tl_e","tl_token","tl_re","tl_exp","date","Date","expTime","parseInt","tokens","over3h","getTime","post","then","res","data","accessToken","accessTokenExpiresIn","refreshToken","catch","err","defaults","headers","common"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\"\nimport { auth } from \"../_actions/user_actions\"\nimport { useSelector, useDispatch } from \"react-redux\"\nimport { useCookies } from \"react-cookie\"\nimport Axios from \"axios\"\nimport { useHistory } from \"react-router-dom\"\n\nexport default function authHoc(SpecificComponent, option, adminRoute = null) {\n    function AuthenticationCheck(props) {\n\n      const [cookies, setCookie, removeCookie] = useCookies([])\n      let user = useSelector(state => state.user)\n      const history = useHistory()\n      const dispatch = useDispatch()\n\n      const removeCookies = () => {\n        removeCookie(\"tl_e\")\n        removeCookie(\"tl_re\")\n        removeCookie(\"tl_exp\")\n        removeCookie(\"tl_token\")\n        window.location.reload()\n        history.push(\"/login\")\n      }\n\n      useEffect(() => {\n        if(cookies.tl_e && cookies.tl_token && cookies.tl_re && cookies.tl_exp) {\n          const date = new Date()\n          const expTime = parseInt(cookies.tl_exp)\n\n          const tokens = {\n            \"accessToken\": cookies.tl_token,\n            \"refreshToken\": cookies.tl_re\n          }\n\n          let over3h = expTime + 10800000\n\n          if(date.getTime() > expTime) {\n            // 로그인 후 3시간 이상 지났을 때는 cookie 삭제\n            if(date.getTime() > over3h) {\n              removeCookies()\n            }\n\n            Axios.post(\"/auth/reissue\", tokens)\n              .then(res => {\n                setCookie(\"tl_token\", res.data.accessToken)\n                setCookie(\"tl_exp\", res.data.accessTokenExpiresIn)\n                setCookie(\"tl_re\", res.data.refreshToken)\n                history.push(\"/mypage\")\n                window.location.reload()\n              })\n              .catch(err => {\n                removeCookies()\n              })\n            }\n\n          // member 정보 가져오기 위해 header에 token 담아서 넘김\n          Axios.defaults.headers.common['Authorization'] = `Bearer ${cookies.tl_token}`\n          dispatch(auth(cookies.tl_e))\n        // cookie에 token 관련 값 4개 중 하나라도 없으면 쿠키 삭제 후 login 페이지로 이동\n        } else {\n          if (option) {\n            removeCookie(\"tl_e\")\n            removeCookie(\"tl_re\")\n            removeCookie(\"tl_exp\")\n            removeCookie(\"tl_token\")\n            history.push(\"/login\")\n          }\n        }\n      }, [cookies])\n\n      return (\n        <SpecificComponent {...props} user={user} />\n      )\n    }\n  return AuthenticationCheck\n}\n"]},"metadata":{},"sourceType":"module"}