{"ast":null,"code":"import _toConsumableArray from\"C:/dev/springboot/workplace/tiltest3/src/main/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/dev/springboot/workplace/tiltest3/src/main/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"C:/dev/springboot/workplace/tiltest3/src/main/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import React,{useState,useEffect}from\"react\";import TopMaster from\"./Sections/TopMaster\";import MiddleDetail from\"./Sections/MiddleDetail\";import BottomComment from\"./Sections/BottomComment\";import SideScroll from\"./Sections/SideScroll\";import LikeToggle from\"./Sections/LikeToggle\";import styled from\"styled-components\";import{useParams}from\"react-router-dom\";import Axios from\"axios\";var DetailDiv=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin: 3rem 5rem;\\n\"])));var MiddleDiv=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: flex;\\n\"])));var Detail=function Detail(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),masterData=_useState2[0],setMasterData=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),nickname=_useState4[0],setNickname=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),countList=_useState6[0],setCountList=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),detailDateString=_useState8[0],setDetailDateString=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),title=_useState10[0],setTitle=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),content=_useState12[0],setContent=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),id=_useState14[0],setId=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),loginStatus=_useState16[0],setLoginStatus=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),comment=_useState18[0],setComment=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),toggle=_useState20[0],setToggle=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),likeCount=_useState22[0],setLikeCount=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),star=_useState24[0],setStar=_useState24[1];var _useState25=useState(\"\"),_useState26=_slicedToArray(_useState25,2),commentContent=_useState26[0],setCommentContent=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),modifyStatus=_useState28[0],setModifyStatus=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),hideInput=_useState30[0],setHideInput=_useState30[1];var _useState31=useState(0),_useState32=_slicedToArray(_useState31,2),modifyIndex=_useState32[0],setModifyIndex=_useState32[1];var param=useParams();useEffect(function(){var detailDatestringArr=_toConsumableArray(detailDateString);var titleArr=_toConsumableArray(title);var contentArr=_toConsumableArray(content);var idArr=_toConsumableArray(id);var refineDate=[];// timeline master 가져오기\nAxios.get(\"/timeline/master/list\").then(function(res){if(res.data){var data=res.data.filter(function(item){return item.id.toString()===param.timelineId;});setMasterData(data[0]);Axios.get(\"/auth/nicknames/\".concat(data[0].author)).then(function(res){setNickname(res.data.nickname);});}});// timeline detail 가져오기\nAxios.get(\"/timeline/detail/\".concat(param.timelineId)).then(function(res){if(res.data){setCountList(Object.keys(res.data));setDetailDateString(res.data.scheduleDate);res.data.forEach(function(item,i){refineDate[i]=item.scheduleDate;titleArr[i]=item.title;contentArr[i]=item.content;idArr[i]=item.id.toString();});// scheduleDate에 - 문자열 붙이기\nrefineDate.forEach(function(item,i){detailDatestringArr[i]=item.substring(0,4)+\"-\"+item.substring(4,6)+\"-\"+item.substring(6,8);});setDetailDateString(detailDatestringArr);setTitle(titleArr);setContent(contentArr);setId(idArr);}});// comment 리스트 가져오기\nAxios.get(\"/timeline/comment/list\").then(function(res){var data=res.data.filter(function(item){return item.masterId.toString()===param.timelineId;});setComment(data);});},[]);useEffect(function(){if(props.user.userData!==undefined){setLoginStatus(true);// 렌더링 되자 마자 likeCount 가져오기\nAxios.get(\"/timeline/like/list\").then(function(res){var data=res.data.filter(function(item){return item.masterId.toString()===param.timelineId;});setLikeCount(data.length);Axios.get(\"/auth/getId/\".concat(props.user.userData.email)).then(function(userRes){if(userRes.data){var checkMyLikes=data.filter(function(item){return item.memberId===userRes.data;});// 현재 유저가 like 추천한 글인지 체크 후 아이콘(empty, full) 세팅\nif(checkMyLikes.length!==0){setToggle(true);}}});});// 댓글 작성했는지 안 했는지 상태값 넣어서 comment input 영역 숨기거나 보여주기\nvar check=comment.filter(function(item){return item.nickname===props.user.userData.nickname;});if(check.length!==0){setHideInput(true);}}},[props.user]);var onChangeStar=function onChangeStar(value){setStar(value);};var onChangeCommentContent=function onChangeCommentContent(e){setCommentContent(e.target.value);};var onToggleLike=function onToggleLike(){// 로그인한 상태이고 email 값 있을 때\nif(props.user.userData.email){Axios.get(\"/auth/getId/\".concat(props.user.userData.email)).then(function(res){if(res.data){var variables={masterId:parseInt(param.timelineId),memberId:res.data};// 추천한 상태에서 추천 취소할 때 Icon full->empty\nif(toggle){Axios.post(\"/timeline/like/change\",variables).then(function(res){if(res.data){setLikeCount(res.data.likeCount);setToggle(false);}});// Axios.post(\"/timeline/like/change\", variables)\n// 추천 안 한 상태에서 추천할 때 Icon emtpy->full\n}else{Axios.post(\"/timeline/like/change\",variables).then(function(res){if(res.data){setLikeCount(res.data.likeCount);setToggle(true);}});}}});}};var onSaveComment=function onSaveComment(){if(props.user.userData===undefined){alert(\"로그인 후 작성 가능합니다\");}else{var variables={content:commentContent,masterId:parseInt(param.timelineId),nickname:props.user!==undefined?props.user.userData.nickname:\"\",star:star};// 댓글 내용 유효성 체크\nif(!commentContent||!param.timelineId||!star){alert(\"내용을 입력해 주세요\");return false;}Axios.post(\"/timeline/comment\",variables).then(function(res){if(res.status===200){alert(\"댓글 작성을 완료했습니다\");// 댓글 저장하고 나서 다시 댓글 불러오기\nAxios.get(\"/timeline/comment/list\").then(function(res){var data=res.data.filter(function(item){return item.masterId.toString()===param.timelineId;});setComment(data);// 작성한 댓글이 있을 경우 새 댓글 입력하기 위한 영역 숨기기\nsetHideInput(true);});}});}};var onDelete=function onDelete(commentContent,id,nickname,star){var variables={content:commentContent,masterId:id,nickname:nickname,star:star};//\n// Axios.delete(\"/timeline/comment\", variables)\n//   .then(res => {\n//     console.log(res);\n//   })\n};var onModify=function onModify(i,stars,contents){// 수정 버튼 클릭하면 comment 영역 변경\nsetModifyStatus(true);setModifyIndex(i);setStar(stars);setCommentContent(contents);};return/*#__PURE__*/React.createElement(DetailDiv,null,/*#__PURE__*/React.createElement(TopMaster,{masterData:masterData,nickname:nickname}),/*#__PURE__*/React.createElement(MiddleDiv,null,/*#__PURE__*/React.createElement(MiddleDetail,{countList:countList,detailDateString:detailDateString,title:title,content:content,id:id}),/*#__PURE__*/React.createElement(SideScroll,{countList:countList,id:id})),loginStatus&&/*#__PURE__*/React.createElement(LikeToggle,{toggle:toggle,onToggleLike:onToggleLike,likeCount:likeCount}),/*#__PURE__*/React.createElement(BottomComment,{comment:comment,user:props.user.userData,onSaveComment:onSaveComment,onChangeCommentContent:onChangeCommentContent,onChangeStar:onChangeStar,onDelete:onDelete,onModify:onModify,hideInput:hideInput,modifyStatus:modifyStatus,modifyIndex:modifyIndex,star:star,commentContent:commentContent}));};export default Detail;","map":{"version":3,"sources":["C:/dev/springboot/workplace/tiltest3/src/main/frontend/src/components/Detail/Detail.js"],"names":["React","useState","useEffect","TopMaster","MiddleDetail","BottomComment","SideScroll","LikeToggle","styled","useParams","Axios","DetailDiv","div","MiddleDiv","Detail","props","masterData","setMasterData","nickname","setNickname","countList","setCountList","detailDateString","setDetailDateString","title","setTitle","content","setContent","id","setId","loginStatus","setLoginStatus","comment","setComment","toggle","setToggle","likeCount","setLikeCount","star","setStar","commentContent","setCommentContent","modifyStatus","setModifyStatus","hideInput","setHideInput","modifyIndex","setModifyIndex","param","detailDatestringArr","titleArr","contentArr","idArr","refineDate","get","then","res","data","filter","item","toString","timelineId","author","Object","keys","scheduleDate","forEach","i","substring","masterId","user","userData","undefined","length","email","userRes","checkMyLikes","memberId","check","onChangeStar","value","onChangeCommentContent","e","target","onToggleLike","variables","parseInt","post","onSaveComment","alert","status","onDelete","onModify","stars","contents"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\"\nimport TopMaster from \"./Sections/TopMaster\"\nimport MiddleDetail from \"./Sections/MiddleDetail\"\nimport BottomComment from \"./Sections/BottomComment\"\nimport SideScroll from \"./Sections/SideScroll\"\nimport LikeToggle from \"./Sections/LikeToggle\"\nimport styled from \"styled-components\"\nimport { useParams } from \"react-router-dom\"\nimport Axios from \"axios\"\n\nconst DetailDiv = styled.div`\n  margin: 3rem 5rem;\n`\n\nconst MiddleDiv = styled.div`\n  width: 100%;\n  display: flex;\n`\n\nconst Detail = (props) => {\n  const [masterData, setMasterData] = useState([])\n  const [nickname, setNickname] = useState(\"\")\n  const [countList, setCountList] = useState([])\n  const [detailDateString, setDetailDateString] = useState([])\n  const [title, setTitle] = useState([])\n  const [content, setContent] = useState([])\n  const [id, setId] = useState([])\n  const [loginStatus, setLoginStatus] = useState(false)\n  const [comment, setComment] = useState([])\n  const [toggle, setToggle] = useState(false)\n  const [likeCount, setLikeCount] = useState(0)\n  const [star, setStar] = useState(\"\")\n  const [commentContent, setCommentContent] = useState(\"\")\n  const [modifyStatus, setModifyStatus] = useState(false)\n  const [hideInput, setHideInput] = useState(false)\n  const [modifyIndex, setModifyIndex] = useState(0)\n\n  const param = useParams()\n\n  useEffect(() => {\n    let detailDatestringArr = [...detailDateString]\n    let titleArr = [...title]\n    let contentArr = [...content]\n    let idArr = [...id]\n    let refineDate = []\n\n    // timeline master 가져오기\n    Axios.get(`/timeline/master/list`)\n      .then(res => {\n        if(res.data) {\n          const data = res.data.filter(item => item.id.toString() === param.timelineId)\n          setMasterData(data[0])\n          Axios.get(`/auth/nicknames/${data[0].author}`)\n            .then(res => {\n              setNickname(res.data.nickname)\n            })\n        }\n      })\n\n    // timeline detail 가져오기\n    Axios.get(`/timeline/detail/${param.timelineId}`)\n      .then(res => {\n        if(res.data) {\n          setCountList(Object.keys(res.data))\n          setDetailDateString(res.data.scheduleDate)\n          res.data.forEach((item, i) => {\n            refineDate[i] = item.scheduleDate\n            titleArr[i] = item.title\n            contentArr[i] = item.content\n            idArr[i] = item.id.toString()\n          })\n\n          // scheduleDate에 - 문자열 붙이기\n          refineDate.forEach((item, i) => {\n            detailDatestringArr[i] = item.substring(0, 4) + \"-\" + item.substring(4, 6) + \"-\" + item.substring(6, 8)\n          })\n\n          setDetailDateString(detailDatestringArr)\n          setTitle(titleArr)\n          setContent(contentArr)\n          setId(idArr)\n        }\n      })\n\n      // comment 리스트 가져오기\n      Axios.get(\"/timeline/comment/list\")\n        .then(res => {\n          const data = res.data.filter(item => item.masterId.toString() === param.timelineId)\n          setComment(data)\n        })\n  }, [])\n\n  useEffect(() => {\n    if(props.user.userData !== undefined) {\n      setLoginStatus(true)\n\n      // 렌더링 되자 마자 likeCount 가져오기\n      Axios.get(\"/timeline/like/list\")\n        .then(res => {\n          const data = res.data.filter(item => item.masterId.toString() === param.timelineId)\n          setLikeCount(data.length)\n          Axios.get(`/auth/getId/${props.user.userData.email}`)\n            .then(userRes => {\n              if(userRes.data) {\n                const checkMyLikes = data.filter(item => item.memberId === userRes.data)\n                // 현재 유저가 like 추천한 글인지 체크 후 아이콘(empty, full) 세팅\n                if(checkMyLikes.length !== 0) {\n                  setToggle(true)\n                }\n              }\n            })\n        })\n\n      // 댓글 작성했는지 안 했는지 상태값 넣어서 comment input 영역 숨기거나 보여주기\n      const check = comment.filter(item => item.nickname === props.user.userData.nickname)\n      if(check.length !== 0) {\n        setHideInput(true)\n      }\n    }\n  }, [props.user])\n\n  const onChangeStar = (value) => {\n    setStar(value)\n  }\n\n  const onChangeCommentContent = (e) => {\n    setCommentContent(e.target.value)\n  }\n\n  const onToggleLike = () => {\n    // 로그인한 상태이고 email 값 있을 때\n    if(props.user.userData.email) {\n      Axios.get(`/auth/getId/${props.user.userData.email}`)\n        .then(res => {\n          if(res.data) {\n            const variables = {\n              masterId: parseInt(param.timelineId),\n              memberId: res.data\n            }\n\n            // 추천한 상태에서 추천 취소할 때 Icon full->empty\n            if(toggle) {\n              Axios.post(\"/timeline/like/change\", variables)\n                .then(res => {\n                  if(res.data) {\n                    setLikeCount(res.data.likeCount)\n                    setToggle(false)\n                  }\n                })\n              // Axios.post(\"/timeline/like/change\", variables)\n            // 추천 안 한 상태에서 추천할 때 Icon emtpy->full\n            } else {\n              Axios.post(\"/timeline/like/change\", variables)\n                .then(res => {\n                  if(res.data) {\n                    setLikeCount(res.data.likeCount)\n                    setToggle(true)\n                  }\n                })\n            }\n\n          }\n        })\n    }\n  }\n\n  const onSaveComment = () => {\n    if(props.user.userData === undefined) {\n      alert(\"로그인 후 작성 가능합니다\")\n    } else {\n      const variables = {\n        content: commentContent,\n        masterId: parseInt(param.timelineId),\n        nickname: props.user !== undefined ? props.user.userData.nickname : \"\",\n        star: star\n      }\n\n      // 댓글 내용 유효성 체크\n      if(!commentContent || !param.timelineId || !star) {\n        alert(\"내용을 입력해 주세요\")\n        return false\n      }\n\n      Axios.post(\"/timeline/comment\", variables)\n        .then(res => {\n          if(res.status === 200) {\n            alert(\"댓글 작성을 완료했습니다\")\n            // 댓글 저장하고 나서 다시 댓글 불러오기\n            Axios.get(\"/timeline/comment/list\")\n              .then(res => {\n                const data = res.data.filter(item => item.masterId.toString() === param.timelineId)\n                setComment(data)\n                // 작성한 댓글이 있을 경우 새 댓글 입력하기 위한 영역 숨기기\n                setHideInput(true)\n              })\n          }\n        })\n    }\n  }\n\n  const onDelete = (commentContent, id, nickname, star) => {\n    let variables = {\n      content: commentContent,\n      masterId: id,\n      nickname: nickname,\n      star: star\n    }\n\n    //\n    // Axios.delete(\"/timeline/comment\", variables)\n    //   .then(res => {\n    //     console.log(res);\n    //   })\n  }\n\n  const onModify = (i, stars, contents) => {\n    // 수정 버튼 클릭하면 comment 영역 변경\n    setModifyStatus(true)\n    setModifyIndex(i)\n    setStar(stars)\n    setCommentContent(contents)\n  }\n\n  return (\n    <DetailDiv>\n      <TopMaster masterData={masterData} nickname={nickname} />\n      <MiddleDiv>\n        <MiddleDetail countList={countList} detailDateString={detailDateString} title={title} content={content} id={id} />\n        <SideScroll countList={countList} id={id} />\n      </MiddleDiv>\n      { /* 로그인 시에만 추천 버튼 노출 */ }\n      { loginStatus &&\n        <LikeToggle toggle={toggle} onToggleLike={onToggleLike} likeCount={likeCount} />\n      }\n      <BottomComment comment={comment} user={props.user.userData} onSaveComment={onSaveComment} onChangeCommentContent={onChangeCommentContent} onChangeStar={onChangeStar}\n        onDelete={onDelete} onModify={onModify} hideInput={hideInput} modifyStatus={modifyStatus} modifyIndex={modifyIndex} star={star} commentContent={commentContent} />\n    </DetailDiv>\n  )\n}\n\nexport default Detail\n"]},"metadata":{},"sourceType":"module"}